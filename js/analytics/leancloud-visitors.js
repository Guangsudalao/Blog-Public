function u(){function c(e){return e=encodeURI(e),document.getElementById(e).querySelector(".leancloud-visitors-count")}function p(e){let s=document.querySelector(".leancloud_visitors"),n=decodeURI(s.id),t=s.dataset.flagTitle;e("get",`/classes/Counter?where=${encodeURIComponent(JSON.stringify({url:n}))}`).then(o=>o.json()).then(({results:o})=>{if(o.length>0){let r=o[0];c(n).innerText=r.time+1,e("put",`/classes/Counter/${r.objectId}`,{time:{__op:"Increment",amount:1}}).catch(l=>{console.error("Failed to save visitor count",l)})}else e("post","/classes/Counter",{title:t,url:n,time:1}).then(r=>r.json()).then(()=>{c(n).innerText=1}).catch(r=>{console.error("Failed to create",r)})}).catch(o=>{console.error("LeanCloud Counter Error",o)})}function h(e){let n=[...document.querySelectorAll(".leancloud_visitors")].map(t=>decodeURI(t.id));e("get",`/classes/Counter?where=${encodeURIComponent(JSON.stringify({url:{$in:n}}))}`).then(t=>t.json()).then(({results:t})=>{for(let o of n){let r=t.find(l=>l.url===o);c(o).innerText=r?r.time:0}}).catch(t=>{console.error("LeanCloud Counter Error",t)})}let{app_id:i,app_key:f,server_url:m}=CONFIG.leancloudVisitors;function a(e){let s=(n,t,o)=>fetch(`${e}/1.1${t}`,{method:n,headers:{"X-LC-Id":i,"X-LC-Key":f,"Content-Type":"application/json"},body:JSON.stringify(o)});CONFIG.page.isPost?p(s):document.querySelectorAll(".post-title-link").length>=1&&h(s)}let d=m||`https://${i.slice(0,8).toLowerCase()}.api.lncldglobal.com`;d?a(d):fetch(`https://app-router.leancloud.cn/2/route?appId=${i}`).then(e=>e.json()).then(({api_server:e})=>{a(`https://${e}`)})}document.addEventListener("DOMContentLoaded",u);document.addEventListener("pjax:success",u);
